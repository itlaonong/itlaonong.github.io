---
title: 梅林固件（ASUS AC86U）通过frp做内网穿透
date: 2020-01-08 20:09:07
category: 杂记
tags:
  - 梅林
  - ASUS
  - frp
permalink: /pages/f0ec69/
categories:
  - 历史文章
author:
  name: itlaonong
  link: https://github.com/itlaonong
---

# 梅林固件（ASUS AC86U）通过 frp 做内网穿透

最近为了给域名备案买了台阿里云服务器（在上海没居住证还不能备案，还要再等等...）。想着服务器能干点啥，银子花了不能浪费呀！虽然按照经济学理论来说，沉没成本不是成本，但是不能浪费就对了。

这里要提一下，现在的 ipv4 太难搞了。家里之前安装的电信宽带，用的 SDN 随选网关，桥连都不能改，更别说公网 ip 了。现在家里的移动宽带也是一样。自己改了桥连。用新买的 AC86U 拨号。不得不说这个路由器还是很棒的。

扯远了。下面记录下具体操作。

<!-- more -->

## frp

先简单介绍一下 frp。[Github](https://github.com/fatedier/frp)上有详细介绍。

这个软件很简单。主要就 4 个文件

1. frps

2. frps.ini

3. frpc

4. frpc.ini

从名字就可以看出来，前面 2 个是服务端使用的软件和配置文件（s->server），后面 2 个是客户端使用的软件和配置文件（c->client）。

顺便说一下，因为存在服务端和客户端，就存在版本对应问题。就是服务端和客户端的版本要匹配。部分版本可以跨版本兼容（具体没有测试，网上看到有人提到）。我为了省事，都采用同一版本。一开始没注意这个问题。先在服务器一通操作，安装了 frps-0.30.0。而梅林软件中心安装的 frpc 插件对应的版本是 0.20.0，客户端一直无法正常连接到服务端。

## 准备材料

1. 一台服务器（有公网 ip）（网上也有别人搭建的免费服务器，自己看着办吧）
2. 一台梅林路由器（其实华硕官改也行，主要要能安装插件）（推荐 koolshare 网站，上面有很多介绍）

## 路由器安装 frpc 插件

在路由器的软件中心，选择 frpc 安装一下就好。

这里注意一下对应 frpc 的版本。因为我们最好是服务器的 frps 和客户端的 frpc 版本要一致。不然可能出现连接不上的问题。

## 服务端 frps 安装

到 frp 的 github 仓库[releases](https://github.com/fatedier/frp/releases)里面找到对应的 frp 版本（cpu 型号和 frp 版本号）

因为我客户端插件的 frpc 版本是 0.20.0。我就直接找 0.20.0 的文件。（不得不说更新真快，要不就是路由器插件更新地太慢！）

直接通过 wget 命令下载到服务器。

```bash
wget https://github.com/fatedier/frp/releases/download/v0.20.0/frp_0.20.0_linux_amd64.tar.gz
```

下载完成后解压

```bash
tar -xvf frp_0.20.0_linux_amd64.tar.gz
```

将文件夹移动到`/usr/local`下,顺便改个名字

```bash
mv frp_0.20.0_linux_amd64 /usr/local/frp
cd /usr/local/frp
```

通过`ll`命令可以看到，主要就是前面介绍的几个文件。

```bash
-rwxr-xr-x 1 root root 7434880 Jan  7 21:04 frpc
-rw-r--r-- 1 root root    5694 Jan  7 21:04 frpc_full.ini
-rw-r--r-- 1 root root     126 Jan  7 21:04 frpc.ini
-rwxr-xr-x 1 root root 8871488 Jan  7 21:04 frps
-rw-r--r-- 1 root root    2298 Jan  7 21:04 frps_full.ini
-rw-r--r-- 1 root root     389 Jan  7 21:05 frps.ini
-rw-r--r-- 1 root root   11358 Jan  7 21:04 LICENSE
```

这样基本算安装好了。

## 配置 frps.ini

```ini
[common]
bind_addr = 0.0.0.0
bind_port = 7000 #给客户端连接的端口
vhost_http_port = 80 #http协议服务端监听接口
vhost_https_port = 443 #https协议服务端监听接口
dashboard_addr = 0.0.0.0
dashboard_port = 7500 #控制台端口
dashboard_user = admin #控制台用户名
dashboard_pwd = admin #控制台密码
log_file = ./frps.log #日志文件
log_level = info #日志级别
log_max_days = 3 #日志保留几天
token = admin      #这里设置你的frp token
max_pool_count = 50
max_ports_per_client = 0
#subdomain_host = frps.com
tcp_mux = true
```

通过命令`./frps -c frps.ini`就可以启动服务。

后台启动命令为`nohup ./frps -c frps.ini &`

## 配置 frpc 插件

插件我们使用自定义配置：

[![frpc-1.png](https://i.postimg.cc/GpqHSVVC/frpc-1.png)](https://postimg.cc/CZnhRPwP)

配置内容

```ini
[common]
server_addr = frps.frp.com #你的服务器地址，绑定域名更方便
server_port = 7000 #服务器端口
token = admin   #服务器token
log_file = /tmp/frpc.log #服务器token
log_level = info
log_max_days = 3

[web]
type = http #访问协议
privilege_mode = true
local_ip = 192.168.0.1 #本地地址
local_port = 80 #本地端口
custom_domains = asus.frp.com #域名
```

点击提交就可以了。
